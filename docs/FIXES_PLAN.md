# План исправлений и доработок AILLM

## Приоритет 1: Критические исправления (немедленно)

### ✅ Fix 1: SQLite в async коде
**Статус:** УЖЕ ИСПРАВЛЕНО - используется aiosqlite
**Действие:** Улучшить использование транзакций

### Fix 2: Дублирование роутера
**Файл:** `backend/main.py`
**Проблема:** Проверить наличие дублирования
**Действие:** Убедиться что нет дублирования

### Fix 3: asyncio.run() в __exit__
**Файл:** `backend/core/engine.py`
**Проблема:** Может вызвать RuntimeError
**Действие:** Убрать asyncio.run(), оставить только логирование

## Приоритет 2: Важные исправления

### Fix 4: Транзакции SQLite
**Файл:** `backend/memory/long_term.py`
**Действие:** Улучшить использование транзакций (уже частично есть)

### Fix 5: Унификация Pydantic методов
**Действие:** Проверить использование pydantic_to_dict везде

### Fix 6: LRU Cache с ограничением
**Файлы:** `backend/core/advanced_cache.py`, `backend/rag/cache.py`
**Действие:** Добавить ограничение размера

### Fix 7: Rate Limiting
**Действие:** Создать middleware для rate limiting

### Fix 8: Удалить debug код
**Файл:** `frontend/src/components/CodeEditor.tsx`
**Действие:** Удалить fetch запросы для debug

---

## Порядок выполнения:

1. ✅ Проверить и улучшить транзакции в long_term.py
2. ✅ Убрать asyncio.run() из engine.py
3. ✅ Проверить дублирование роутера
4. ✅ Улучшить использование транзакций
5. ✅ Добавить LRU cache ограничения
6. ✅ Создать rate limiting middleware
7. ✅ Удалить debug код из frontend

