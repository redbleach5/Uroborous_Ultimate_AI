# Архитектура AILLM

## Обзор

AILLM - это комплексная система автономных агентов для разработки ПО на основе LLM. Система построена на принципах модульности, расширяемости и безопасности.

## Основные компоненты

### 1. Core Engine (IDAEngine)

**Расположение**: `backend/core/engine.py`

Центральный координатор всех компонентов системы:
- Управление жизненным циклом компонентов
- Инициализация и shutdown всех подсистем
- Координация взаимодействия между компонентами
- Обработка ошибок и восстановление

### 2. LLM Provider Manager

**Расположение**: `backend/llm/`

Поддержка множественных LLM провайдеров:
- **OpenAI Provider** (`openai_provider.py`): Интеграция с OpenAI API
- **Anthropic Provider** (`anthropic_provider.py`): Интеграция с Anthropic Claude API
- **Ollama Provider** (`ollama_provider.py`): Поддержка локальных моделей через Ollama

Особенности:
- Автоматический выбор провайдера
- Fallback механизмы при ошибках
- Кэширование ответов
- Приоритет локальным моделям (Ollama) для экономии

### 3. RAG Система

**Расположение**: `backend/rag/`

#### Vector Store (`vector_store.py`)
- Семантический поиск с использованием FAISS
- BM25 для текстового поиска
- Генерация эмбеддингов через sentence-transformers
- Re-ranking результатов

#### Context Manager (`context_manager.py`)
- Иерархическое управление контекстом
- Query expansion для улучшения поиска
- Multi-query retrieval
- История взаимодействий

### 4. Агенты

**Расположение**: `backend/agents/`

#### BaseAgent (`base.py`)
Базовый класс для всех агентов с общими методами.

#### CodeWriterAgent (`code_writer.py`)
- Генерация кода по описанию
- Рефакторинг существующего кода
- Создание тестов

#### ReactAgent (`react.py`)
- ReAct подход (Reasoning + Acting)
- Интерактивное решение задач
- Использование инструментов
- Цикл: Thought → Action → Observation → Final Answer

#### ResearchAgent (`research.py`)
- Исследование кодовой базы
- Анализ требований
- Анализ архитектуры
- Генерация отчетов

### 5. Orchestrator

**Расположение**: `backend/orchestrator.py`

- Декомпозиция сложных задач на подзадачи
- Планирование выполнения
- Распределение задач между агентами
- Параллельное выполнение независимых задач
- Автоматическое восстановление

### 6. Система инструментов

**Расположение**: `backend/tools/`

#### Tool Registry (`registry.py`)
Централизованный реестр всех инструментов.

#### Реализованные инструменты:
- **File Tools** (`file_tools.py`): Чтение, запись, список файлов
- **Shell Tools** (`shell_tools.py`): Выполнение команд
- **Git Tools** (`git_tools.py`): Git операции

### 7. Safety Guard

**Расположение**: `backend/safety/guard.py`

Защита от опасных операций:
- Валидация команд (защита от `rm -rf`, `format`, etc.)
- Валидация путей (защита от path traversal)
- Валидация URL (защита от SSRF)
- Блокировка опасных паттернов

### 8. Long Term Memory

**Расположение**: `backend/memory/long_term.py`

- Сохранение успешных решений
- Семантический поиск похожих задач
- SQLite для хранения
- Эмбеддинги для семантического поиска
- Автоматическая очистка старых записей

### 9. API Server

**Расположение**: `backend/main.py`, `backend/api/routers/`

FastAPI приложение с:
- RESTful API endpoints
- WebSocket для real-time коммуникации
- Модульная структура роутеров:
  - Tasks router: Выполнение задач
  - Code router: Генерация кода
  - Tools router: Управление инструментами
  - Config router: Управление конфигурацией
  - Monitoring router: Мониторинг системы

### 10. Frontend

**Расположение**: `frontend/`

React + TypeScript + Tauri приложение:
- **MainLayout**: Главный layout с табами
- **CodeEditor**: Редактор кода с Monaco Editor
- **TaskPanel**: Панель для выполнения задач
- **MonitoringPanel**: Мониторинг системы
- **API Client**: Клиент для взаимодействия с backend

## Поток данных

```
User Request
    ↓
API Server / WebSocket
    ↓
IDAEngine
    ↓
Orchestrator (для сложных задач)
    ↓
Agent Selection
    ↓
Agent Execution
    ├─→ LLM Provider Manager (генерация ответов)
    ├─→ Context Manager (получение контекста)
    ├─→ Tool Registry (использование инструментов)
    └─→ Long Term Memory (сохранение/поиск решений)
    ↓
Result
    ↓
User Response
```

## Конфигурация

Все настройки в `config/config.yaml`:
- LLM провайдеры и их параметры
- RAG настройки
- Агенты и их конфигурация
- Безопасность
- Производительность

## Расширяемость

### Добавление нового агента

1. Создать класс, наследующий `BaseAgent`
2. Реализовать метод `execute()`
3. Зарегистрировать в `AgentRegistry`

### Добавление нового инструмента

1. Создать класс, наследующий `BaseTool`
2. Реализовать метод `execute()`
3. Зарегистрировать в `ToolRegistry`

### Добавление нового LLM провайдера

1. Создать класс, наследующий `BaseLLMProvider`
2. Реализовать методы `generate()`, `stream()`, `list_models()`
3. Зарегистрировать в `LLMProviderManager`

## Безопасность

- Safety Guard проверяет все команды и пути
- Изоляция выполнения (можно включить sandbox)
- Валидация всех входных данных
- Защита от SSRF/XSS
- Блокировка опасных паттернов

## Производительность

- Кэширование LLM ответов
- Кэширование эмбеддингов
- Параллельное выполнение задач
- Ленивая загрузка компонентов
- Оптимизация для локального использования (Ollama)

## Будущие улучшения

Планируемые функции для дальнейшего развития:
- Расширенная мультимодальная обработка (улучшение существующих процессоров)
- Расширение AutoML компонентов (дополнительные алгоритмы оптимизации)
- Визуальный конструктор workflow (графический интерфейс для создания workflow)
- Дополнительные специализированные агенты (расширение функциональности существующих)

