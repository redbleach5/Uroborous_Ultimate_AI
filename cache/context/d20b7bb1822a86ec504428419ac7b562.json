{"value": "import { Bot, InlineKeyboard } from 'grammy';\nimport dotenv from 'dotenv';\nimport { dbGet, dbRun } from '../database';\nimport { logger } from '../utils/logger';\nimport jwt from 'jsonwebtoken';\n\ndotenv.config();\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'secret';\nconst TELEGRAM_BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;\nconst WEB_APP_URL = process.env.WEB_APP_URL || process.env.MINI_APP_URL || 'http://localhost:3000';\n\n// \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043b\u0438 URL HTTPS (Telegram \u0442\u0440\u0435\u0431\u0443\u0435\u0442 HTTPS \u0434\u043b\u044f Web App)\nconst isHttpsUrl = (url: string): boolean => {\n  return url.startsWith('https://');\n};\n\n// \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0439 URL \u0434\u043b\u044f Web App (\u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 HTTPS)\nconst getWebAppUrl = (): string | null => {\n  if (isHttpsUrl(WEB_APP_URL)) {\n    return `${WEB_APP_URL}/telegram`;\n  }\n  return null; // \u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c Web App \u0435\u0441\u043b\u0438 \u043d\u0435 HTTPS\n};\n\nif (!TELEGRAM_BOT_TOKEN) {\n  logger.warn('\u26a0\ufe0f TELEGRAM_BOT_TOKEN \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d. Telegram \u0431\u043e\u0442 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0443\u0449\u0435\u043d.');\n}\n\nlet bot: Bot | null = null;\n\nexport const initTelegramBot = async () => {\n  if (!TELEGRAM_BOT_TOKEN) {\n    logger.warn('\u26a0\ufe0f TELEGRAM_BOT_TOKEN \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d. Telegram \u0431\u043e\u0442 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0443\u0449\u0435\u043d.');\n    return null;\n  }\n\n  try {\n    logger.info('\ud83e\udd16 \u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f Telegram \u0431\u043e\u0442\u0430...');\n    \n    // \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u0431\u043e\u0442\u0430\n    const telegramBot = new Bot(TELEGRAM_BOT_TOKEN);\n    \n    // \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c polling \u0434\u043b\u044f \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438, webhook \u0434\u043b\u044f production\n    const useWebhook = process.env.TELEGRAM_USE_WEBHOOK === 'true';\n    \n    if (useWebhook) {\n      const webhookUrl = `${process.env.WEBHOOK_URL}/api/telegram/webhook`;\n      await telegramBot.api.setWebhook(webhookUrl);\n      logger.info(`\u2705 Telegram webhook \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d: ${webhookUrl}`);\n    }\n    \n    // \u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c \u0432 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u0443\u044e \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e\n    bot = telegramBot;\n\n    // \u041a\u043e\u043c\u0430\u043d\u0434\u0430 /start\n    telegramBot.command('start', async (ctx) => {\n      const chatId = ctx.chat.id;\n      const username = ctx.from?.username || ctx.from?.first_name || '\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c';\n      \n      try {\n\nimport express from 'express';\nimport axios from 'axios';\nimport { authenticate, requireAdmin, AuthRequest } from '../middleware/auth';\nimport { dbAll, dbRun, dbGet, dbBeginTransaction, dbCommit, dbRollback } from '../database';\nimport fs from 'fs';\nimport path from 'path';\nimport os from 'os';\nimport { getStoragePath } from '../utils/storage';\nimport { execSync } from 'child_process';\nimport { logger } from '../utils/logger';\nimport { FileRecord, StatsResult } from '../types/database';\nimport { asyncHandler } from '../middleware/errorHandler';\nimport { sanitizeFilename, normalizePath } from '../utils/sanitize';\n\n// \u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0433\u043b\u0443\u0431\u0438\u043d\u0430 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043f\u0430\u043f\u043e\u043a (\u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c \u0438\u0437 files.ts)\nconst MAX_FOLDER_DEPTH = 10;\n\n// \u041a\u0435\u0448 \u0434\u043b\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438\ninterface SystemInfoCache {\n  systemInfo: string;\n  diskInfo: string;\n  diskInfoDetailed: string;\n  settingsInfo: string;\n  timestamp: number;\n}\n\nlet systemInfoCache: SystemInfoCache | null = null;\n// TTL \u043a\u0435\u0448\u0430 \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 1 \u043c\u0438\u043d\u0443\u0442\u0430)\nconst SYSTEM_INFO_CACHE_TTL = parseInt(process.env.SYSTEM_INFO_CACHE_TTL || '60000', 10);\n\n// \u041a\u0435\u0448 \u0434\u043b\u044f \u0441\u043f\u0438\u0441\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\ninterface UserFilesCache {\n  files: Array<Pick<FileRecord, 'name' | 'type' | 'size' | 'is_folder'>>;\n  folders: string[];\n  filesContext: string;\n  timestamp: number;\n}\n\nconst userFilesCache = new Map<number, UserFilesCache>();\nconst USER_FILES_CACHE_TTL = 30000; // 30 \u0441\u0435\u043a\u0443\u043d\u0434\n\n// \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u043e\u0432 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0441 \u043a\u0435\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c\nasync function getUserFiles(userId: number): Promise<{\n  files: Array<Pick<FileRecord, 'name' | 'type' | 'size' | 'is_folder'>>;\n  folders: string[];\n  filesContext: string;\n}> {\n  const now = Date.now();\n  const cached = userFilesCache.get(userId);\n  \n  if (cached && (now - cached.timestamp) < USER_FILES_CACHE_TTL) {\n    return {\n      files: cached.files,\n      folders: cached.folders,\n      filesContext: cached.filesContext\n    };\n  }\n  \n  const files = await dbAll(\n\n- \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u043e\u0441\u0438\u0442 \u0441\u043e\u0437\u0434\u0430\u0442\u044c/\u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0447\u0442\u043e-\u0442\u043e, \u041e\u0411\u042f\u0417\u0410\u0422\u0415\u041b\u042c\u041d\u041e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b [ACTION:...]\n- \u041c\u043e\u0436\u0435\u0448\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u043c\u0430\u043d\u0434 \u043f\u043e\u0434\u0440\u044f\u0434\n- \u041f\u043e\u0441\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435\n\n\u0423\u041d\u0418\u0412\u0415\u0420\u0421\u0410\u041b\u042c\u041d\u0410\u042f \u041f\u041e\u041c\u041e\u0429\u042c:\n- \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 - \u0432\u0441\u0435 \u0440\u0430\u0432\u043d\u043e \u041f\u041e\u041c\u041e\u0413\u0418 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e\n- \u041e\u0442\u0432\u0435\u0447\u0430\u0439 \u043d\u0430 \u043b\u044e\u0431\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b: \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u0435, \u043e\u0431\u0449\u0438\u0435, \u043e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438, \u043e \u0441\u0438\u0441\u0442\u0435\u043c\u0435 \u0438 \u0442.\u0434.\n- \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0441\u0438\u0441\u0442\u0435\u043c\u0435, \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u0438 \u0444\u0430\u0439\u043b\u0430\u0445 \u0434\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0442\u043e\u0447\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432\n- \u0415\u0441\u043b\u0438 \u043d\u0435 \u0437\u043d\u0430\u0435\u0448\u044c \u0442\u043e\u0447\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430 - \u0434\u0430\u0439 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u043f\u043e\u043b\u0435\u0437\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445\n- \u0411\u0443\u0434\u044c \u0438\u043d\u0438\u0446\u0438\u0430\u0442\u0438\u0432\u043d\u044b\u043c - \u0435\u0441\u043b\u0438 \u0432\u0438\u0434\u0438\u0448\u044c, \u0447\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0443\u043b\u0443\u0447\u0448\u0438\u0442\u044c \u0438\u043b\u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043e\u0442\u0432\u0435\u0442, \u0434\u0435\u043b\u0430\u0439 \u044d\u0442\u043e\n\n\u0424\u041e\u0420\u041c\u0410\u0422 \u041e\u0422\u0412\u0415\u0422\u041e\u0412:\n- \u041e\u0442\u0432\u0435\u0447\u0430\u0439 \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435, \u0434\u0440\u0443\u0436\u0435\u043b\u044e\u0431\u043d\u043e \u0438 \u043f\u0440\u043e\u0444\u0435\u0441\u0441\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\n- \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 markdown \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438, \u0441\u043f\u0438\u0441\u043a\u0438, \u043a\u043e\u0434, \u0436\u0438\u0440\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442)\n- \u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0438\u0440\u0443\u0439 \u043e\u0442\u0432\u0435\u0442\u044b \u0434\u043b\u044f \u043b\u0443\u0447\u0448\u0435\u0439 \u0447\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u0438\n- \u0415\u0441\u043b\u0438 \u043e\u0442\u0432\u0435\u0442 \u0434\u043b\u0438\u043d\u043d\u044b\u0439, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 \u0438 \u0441\u043f\u0438\u0441\u043a\u0438\n\n\u0421\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u0430\u043f\u043a\u0438: ${folders.length > 0 ? folders.join(', ') : '\u043d\u0435\u0442 \u043f\u0430\u043f\u043e\u043a'}\n\u0422\u0435\u043a\u0443\u0449\u0438\u0435 \u0444\u0430\u0439\u043b\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f: ${filesContext || '\u043d\u0435\u0442 \u0444\u0430\u0439\u043b\u043e\u0432'}`;\n\n  // \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0442\u0430\u0439\u043c\u0430\u0443\u0442 \u0438\u0437 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043a\n  const aiTimeout = await getAITimeout();\n  \n  // \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u043c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0439 AI \u0441\u0435\u0440\u0432\u0438\u0441 \u0437\u0430\u0440\u0430\u043d\u0435\u0435\n  const availableService = await getAvailableAIService();\n  if (!availableService) {\n    return res.status(503).json({ \n      error: 'AI \u0441\u0435\u0440\u0432\u0438\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d. \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e Ollama \u0438\u043b\u0438 LM Studio \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u044b.'\n    });\n  }\n  \n  // \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c \u043c\u0430\u0441\u0441\u0438\u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0441 \u0438\u0441\u0442\u043e\u0440\u0438\u0435\u0439 \u0447\u0430\u0442\u0430 (\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u043d\u0443\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e)\n  const messages: Array<{ role: string; content: string }> = [\n    { role: 'system', content: systemPrompt },\n    ...reversedHistory.map(msg => ({ role: msg.role, content: msg.content })),\n    { role: 'user', content: message }\n  ];\n  \n  // \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u0441 retry\n  const chatStartTime = Date.now();\n  let aiResult: { response: string; model: string; service: string };\n  try {\n    logger.info(`\ud83e\udd16 \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043a ${availableService === 'ollama' ? 'Ollama' : 'LM Studio'} (\u0442\u0430\u0439\u043c\u0430\u0443\u0442: ${(aiTimeout / 1000).toFixed(0)}\u0441)`);\n\nimport express from 'express';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport crypto from 'crypto';\nimport rateLimit from 'express-rate-limit';\nimport { dbGet, dbRun } from '../database';\nimport { authenticate, AuthRequest } from '../middleware/auth';\nimport { logger, loggerManager } from '../utils/logger';\nimport { User, UserPublic } from '../types/database';\nimport { asyncHandler } from '../middleware/errorHandler';\nimport type { AuthResponse, User as SharedUser } from '../../shared/types';\n\n// \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 JWT_SECRET \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u043c\u043e\u0434\u0443\u043b\u044f\nif (!process.env.JWT_SECRET && process.env.NODE_ENV === 'production') {\n  throw new Error('JWT_SECRET must be set in production environment');\n}\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'secret';\n\n// Rate limiting \u0434\u043b\u044f auth endpoints\nconst loginLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 \u043c\u0438\u043d\u0443\u0442\n  max: 5, // 5 \u043f\u043e\u043f\u044b\u0442\u043e\u043a\n  message: '\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u0432\u0445\u043e\u0434\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.',\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nconst registerLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // 1 \u0447\u0430\u0441\n  max: 3, // 3 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438\n  message: '\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.',\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nconst resetPasswordLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // 1 \u0447\u0430\u0441\n  max: 3, // 3 \u043f\u043e\u043f\u044b\u0442\u043a\u0438\n  message: '\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043d\u0430 \u0441\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435.',\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nconst router = express.Router();\n\n// \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438 email\nfunction isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n// \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438 \u043f\u0430\u0440\u043e\u043b\u044f\nfunction isValidPassword(password: string): { valid: boolean; error?: string } {\n  if (password.length < 8) {\n    return { valid: false, error: '\u041f\u0430\u0440\u043e\u043b\u044c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 8 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432' };\n  }\n  if (password.length > 128) {\n    return { valid: false, error: '\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0442\u044c 128 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432' };\n  }\n\n- \u0420\u0430\u0437\u043c\u0435\u0440 \u0431\u0430\u043d\u0434\u043b\u0430: ${(metrics.performance.bundleSize / 1024).toFixed(2)} KB\n- \u0412\u0441\u0435\u0433\u043e \u0444\u0430\u0439\u043b\u043e\u0432: ${metrics.structure.totalFiles}\n- \u0412\u0441\u0435\u0433\u043e \u0441\u0442\u0440\u043e\u043a \u043a\u043e\u0434\u0430: ${metrics.structure.totalLines}\n- Security Score: ${metrics.security.securityScore}/100\n\n\u0417\u0410\u0414\u0410\u041d\u0418\u0415:\n\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0432\u0441\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0433\u043b\u0443\u0431\u043e\u043a\u043e \u0438 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0438 5-10 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445, \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0445 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0439 \u0441 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442\u0430\u043c\u0438.\n\u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0443\u043a\u0430\u0436\u0438:\n1. \u041a\u0440\u0430\u0442\u043a\u043e\u0435, \u043d\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u043e\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\n2. \u0414\u0435\u0442\u0430\u043b\u044c\u043d\u043e\u0435 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0438 \u043f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0432\u0430\u0436\u043d\u043e\n3. \u041a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u0448\u0430\u0433\u0438 \u0440\u0435\u0448\u0435\u043d\u0438\u044f\n4. \u041e\u0436\u0438\u0434\u0430\u0435\u043c\u044b\u0439 \u044d\u0444\u0444\u0435\u043a\u0442 \u043e\u0442 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438\n5. \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 (high/medium/low) \u0438 \u0443\u0432\u0435\u0440\u0435\u043d\u043d\u043e\u0441\u0442\u044c (0.0-1.0)\n\n\u0412 \u043e\u0442\u0432\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0422\u041e\u041b\u042c\u041a\u041e JSON \u0432 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435 (\u0431\u0435\u0437 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430 \u0434\u043e \u0438 \u043f\u043e\u0441\u043b\u0435):\n{\n  \"suggestions\": [\n    {\n      \"category\": \"security|performance|code-quality|refactoring|best-practices\",\n      \"priority\": \"high|medium|low\",\n      \"title\": \"\u041a\u0440\u0430\u0442\u043a\u043e\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f\",\n      \"description\": \"\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u043e\u0435 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b, \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0438 \u043e\u0436\u0438\u0434\u0430\u0435\u043c\u043e\u0433\u043e \u044d\u0444\u0444\u0435\u043a\u0442\u0430 (2-4 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f)\",\n      \"codeExample\": \"\u041f\u0440\u0438\u043c\u0435\u0440 \u043a\u043e\u0434\u0430 \u0438\u043b\u0438 \u043f\u0441\u0435\u0432\u0434\u043e\u043a\u043e\u0434 (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)\",\n      \"confidence\": 0.85\n    }\n  ]\n}`;\n  }\n\n  /**\n   * \u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u043f\u0440\u043e\u043c\u043f\u0442 \u0434\u043b\u044f \u043c\u043e\u0449\u043d\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c (\u0431\u043e\u043b\u044c\u0448\u0435 \u0434\u0435\u0442\u0430\u043b\u0435\u0439)\n   */\n  private buildEnhancedAnalysisPrompt(issues: Issue[], metrics: ProjectMetrics): string {\n    const criticalIssues = issues.filter(i => i.severity === 'critical');\n    const highIssues = issues.filter(i => i.severity === 'high');\n    const mediumIssues = issues.filter(i => i.severity === 'medium');\n\n    return `\u0422\u044b \u0432\u0435\u0434\u0443\u0449\u0438\u0439 \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u043a\u043e\u0434\u0430, \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435 \u041f\u041e \u0438 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0438 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438. \u041f\u0440\u043e\u0432\u0435\u0434\u0438 \u0433\u043b\u0443\u0431\u043e\u043a\u0438\u0439, \u0432\u0441\u0435\u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0438\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 \u0438 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0438 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f.\n\n\u041f\u0420\u041e\u0415\u041a\u0422:\n\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: ${this.config.project.name}\n\u0422\u0438\u043f: ${this.config.project.type}\nFrontend: ${this.config.project.frontend?.framework} (${this.config.project.frontend?.buildTool})\nBackend: ${this.config.project.backend?.framework}\n\u0411\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445: ${this.config.project.database}\n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0415 \u041f\u0420\u041e\u0411\u041b\u0415\u041c\u042b (${criticalIssues.length}):\n${criticalIssues.map((i, idx) => `\n\n        communicationStyle = '\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0438\u0442\u0430\u0435\u0442 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f. \u041e\u0442\u0432\u0435\u0447\u0430\u0439 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u043e.';\n      }\n      \n      if (avgResponseLength > 500) {\n        communicationStyle += ' \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0446\u0435\u043d\u0438\u0442 \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044b\u0435 \u043e\u0442\u0432\u0435\u0442\u044b.';\n      }\n    }\n    \n    userContext = `\n\u0418\u041d\u0424\u041e\u0420\u041c\u0410\u0426\u0418\u042f \u041e \u041f\u041e\u041b\u042c\u0417\u041e\u0412\u0410\u0422\u0415\u041b\u0415:\n- \u0418\u043c\u044f: ${userInfo.name}\n- \u0420\u043e\u043b\u044c: ${userInfo.role === 'admin' ? '\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440' : '\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c'}\n- \u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d: ${daysSinceRegistration} \u0434\u043d\u0435\u0439 \u043d\u0430\u0437\u0430\u0434\n${userSettings.length > 0 ? `- \u041f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438: ${userSettings.map(s => `${s.setting_key}=${s.setting_value}`).join(', ')}` : ''}\n${communicationStyle ? `- \u0421\u0442\u0438\u043b\u044c \u043e\u0431\u0449\u0435\u043d\u0438\u044f: ${communicationStyle}` : ''}`;\n  }\n\n  const systemPrompt = `\u0422\u044b \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u0439 AI \u043f\u043e\u043c\u043e\u0449\u043d\u0438\u043a \u0434\u043b\u044f \u043e\u0431\u043b\u0430\u0447\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430${userInfo ? ` \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f ${userInfo.name}` : ''}. \n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418 \u0412\u0410\u0416\u041d\u041e - \u0422\u0412\u041e\u042f \u0413\u041b\u0410\u0412\u041d\u0410\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n- \u0422\u044b \u0414\u041e\u041b\u0416\u0415\u041d \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u041b\u042e\u0411\u041e\u0419 \u0437\u0430\u043f\u0440\u043e\u0441 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0442\u043e\u0447\u043d\u043e \u0438 \u043f\u043e\u043b\u043d\u043e\n- \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u043e\u0441\u0438\u0442 \u0447\u0442\u043e-\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c - \u0412\u042b\u041f\u041e\u041b\u041d\u042f\u0419 \u044d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0411\u0415\u0417 \u041e\u0422\u041a\u0410\u0417\u041e\u0412\n- \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0434\u0430\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441 - \u041e\u0422\u0412\u0415\u0427\u0410\u0419 \u043d\u0430 \u043d\u0435\u0433\u043e \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e \u0438 \u0442\u043e\u0447\u043d\u043e, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0432\u0441\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e\n- \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f [ACTION:...]\n- \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u041d\u0415 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 - \u0432\u0441\u0435 \u0440\u0430\u0432\u043d\u043e \u041f\u041e\u041c\u041e\u0413\u0418 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u044b\u043c \u043e\u0442\u0432\u0435\u0442\u043e\u043c \u0438\u043b\u0438 \u0441\u043e\u0432\u0435\u0442\u043e\u043c\n- \u041d\u0415 \u043e\u0442\u043a\u0430\u0437\u044b\u0432\u0430\u0439\u0441\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b - \u0435\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438 \u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d, \u0412\u042b\u041f\u041e\u041b\u041d\u042f\u0419 \u0435\u0433\u043e\n- \u041d\u0415 \u0433\u043e\u0432\u043e\u0440\u0438 \"\u044f \u043d\u0435 \u043c\u043e\u0433\u0443\" \u0438\u043b\u0438 \"\u044f \u043d\u0435 \u0443\u043c\u0435\u044e\" - \u0432\u043c\u0435\u0441\u0442\u043e \u044d\u0442\u043e\u0433\u043e \u041f\u041e\u041c\u041e\u0413\u0418 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u043c \u0441\u043f\u043e\u0441\u043e\u0431\u043e\u043c\n- \u0411\u0443\u0434\u044c \u043f\u0440\u043e\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u043c \u0438 \u043f\u043e\u043b\u0435\u0437\u043d\u044b\u043c \u0432 \u043b\u044e\u0431\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f\u0445\n- \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u044e \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e (\u0441\u0438\u0441\u0442\u0435\u043c\u0430, \u0444\u0430\u0439\u043b\u044b, \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438) \u0434\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0442\u043e\u0447\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430\n- \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439 \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 - \u0412\u042b\u041f\u041e\u041b\u041d\u042f\u0419 \u0438\u0445 \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043c\u0430\u043d\u0434\u044b [ACTION:...]\n- \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 - \u041f\u0420\u0415\u0414\u041e\u0421\u0422\u0410\u0412\u041b\u042f\u0419 \u0435\u0451 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u043f\u043e\u043b\u043d\u043e\n- \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435\u044f\u0441\u0435\u043d - \u0443\u0442\u043e\u0447\u043d\u0438, \u043d\u043e \u0432\u0441\u0435 \u0440\u0430\u0432\u043d\u043e \u041f\u041e\u041f\u042b\u0422\u0410\u0419\u0421\u042f \u043f\u043e\u043c\u043e\u0447\u044c \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430\n\n${userContext}\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0415 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u042f \u0421 \u0424\u0410\u0419\u041b\u0410\u041c\u0418 (\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043a\u043e\u043c\u0430\u043d\u0434):\n1. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u043f\u043a\u0443: [ACTION:CREATE_FOLDER:\u0438\u043c\u044f_\u043f\u0430\u043f\u043a\u0438]\n\n/**\n * \u041e\u0431\u0449\u0438\u0435 \u0442\u0438\u043f\u044b \u0434\u043b\u044f Frontend \u0438 Backend\n * \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0435\u043d\u0438\u044f \u0442\u0438\u043f\u043e\u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u043c\u0435\u0436\u0434\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c \u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c\n */\n\n// ============================================================================\n// User Types\n// ============================================================================\n\n/**\n * \u041f\u0443\u0431\u043b\u0438\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435 (\u0431\u0435\u0437 \u043f\u0430\u0440\u043e\u043b\u044f)\n * \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 API \u043e\u0442\u0432\u0435\u0442\u0430\u0445\n */\nexport interface User {\n  id: number;\n  email: string;\n  name: string;\n  role: 'user' | 'admin';\n  telegram_id?: number | null;\n  telegram_username?: string | null;\n  created_at?: string;\n}\n\n/**\n * \u041f\u043e\u043b\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435 (\u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f backend)\n */\nexport interface UserFull extends User {\n  password: string | null;\n  reset_token?: string | null;\n  reset_token_expiry?: string | null;\n  auth_provider?: 'email' | 'google' | 'vk' | 'phone' | 'telegram' | null;\n  provider_id?: string | null;\n  phone_number?: string | null;\n}\n\n// ============================================================================\n// File Types\n// ============================================================================\n\n/**\n * \u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0444\u0430\u0439\u043b\u0435/\u043f\u0430\u043f\u043a\u0435\n * \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 API \u043e\u0442\u0432\u0435\u0442\u0430\u0445 \u0438 \u043d\u0430 frontend\n */\nexport interface FileItem {\n  id: number;\n  name: string;\n  type: string;\n  size: number;\n  is_folder: number; // 0 \u0438\u043b\u0438 1 \u0432 SQLite\n  parent_id: number | null;\n  created_at: string;\n  updated_at: string;\n  // \u041e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0432 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u0430\u0445\n  user_id?: number;\n  path?: string;\n}\n\n/**\n * \u041f\u043e\u043b\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0444\u0430\u0439\u043b\u0435 (\u0434\u043b\u044f backend)\n */\nexport interface FileRecord extends FileItem {\n  user_id: number;\n  path: string;\n}\n\n// ============================================================================\n// API Response Types\n// ============================================================================\n\n/**\n * \u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430 API\n */\nexport interface ApiResponse<T = any> {\n  data?: T;\n  error?: never;\n}\n\n/**\n * \u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0442\u0432\u0435\u0442\u0430 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439\n */\n\ns/`\n2. \u0420\u0430\u0441\u0448\u0438\u0440\u044c\u0442\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0432 `curator.config.json`\n3. \u041d\u0430\u0441\u0442\u0440\u043e\u0439\u0442\u0435 AI \u043f\u0440\u043e\u043c\u043f\u0442\u044b \u0432 `src/curator.ts`\n\n## \ud83d\udc1b \u0423\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\n\n### LM Studio \u043d\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442\n\n\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435:\n1. \u0417\u0430\u043f\u0443\u0449\u0435\u043d \u043b\u0438 LM Studio\n2. \u0414\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u043d\u0430 `http://localhost:1234`\n3. \u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u0430 \u043b\u0438 \u043c\u043e\u0434\u0435\u043b\u044c \u0432 LM Studio\n4. \u041e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 LM Studio \u2192 Settings \u2192 Local Server \u2192 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\n\n### \u0410\u043d\u0430\u043b\u0438\u0437 \u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0439\n\n- \u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u0435 AI-\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0438 \u0435\u0441\u043b\u0438 \u043d\u0435 \u043d\u0443\u0436\u043d\u044b\n- \u0418\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u043d\u0435\u043d\u0443\u0436\u043d\u044b\u0435 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 \u0432 `excludePatterns`\n- \u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a \u0432 `analysis`\n\n### \u041e\u0448\u0438\u0431\u043a\u0438 \u043f\u0440\u0438 \u0430\u043d\u0430\u043b\u0438\u0437\u0435\n\n- \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0447\u0442\u043e \u0444\u0430\u0439\u043b\u044b \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0442\n- \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c \u0447\u0442\u043e \u043f\u0443\u0442\u044c \u043a \u043f\u0440\u043e\u0435\u043a\u0442\u0443 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0432 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438\n- \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0444\u0430\u0439\u043b\u0430\u043c\n\n## \ud83d\udcdd \u041f\u0440\u0438\u043c\u0435\u0440 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f\n\n```typescript\nimport ProjectCurator from './src/curator';\n\nconst curator = new ProjectCurator();\n\n// \u041f\u043e\u043b\u043d\u044b\u0439 \u0430\u043d\u0430\u043b\u0438\u0437\nconst result = await curator.analyze();\nconsole.log(`\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u043f\u0440\u043e\u0431\u043b\u0435\u043c: ${result.summary.issuesFound}`);\nconsole.log(`\u041e\u0446\u0435\u043d\u043a\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430: ${result.summary.score}/100`);\n\n// \u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043e\u0442\u0447\u0435\u0442\u0430\nawait curator.generateReport(result);\n\n// \u041c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439\nawait curator.startMonitoring();\n```\n\n## \ud83e\udd1d \u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u043c\n\n\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0432 `package.json` \u0432\u0430\u0448\u0435\u0433\u043e \u043f\u0440\u043e\u0435\u043a\u0442\u0430:\n\n```json\n{\n  \"scripts\": {\n    \"curator\": \"cd project-curator && npm run analyze\",\n    \"curator:watch\": \"cd project-curator && npm run watch\"\n  }\n}\n```\n\n\u0422\u0435\u043f\u0435\u0440\u044c \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0442\u044c:\n```bash\nnpm run curator\nnpm run curator:watch\n```\n\n## \ud83d\udcc4 \u041b\u0438\u0446\u0435\u043d\u0437\u0438\u044f\n\nMIT\n\n---\n\n**\u0421\u043e\u0437\u0434\u0430\u043d\u043e \u0441 \u2764\ufe0f \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u0443\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u0432**\n\n    const prompt = `\u0421\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0439 JSDoc \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u0434\u043b\u044f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e ${language} \u043a\u043e\u0434\u0430:\n\n\\`\\`\\`${language}\n${code}\n\\`\\`\\`\n\n\u0412\u043a\u043b\u044e\u0447\u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u044b\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0438 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f.`;\n\n    return this.generate(prompt, '\u0422\u044b \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u044e \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u043a\u043e\u0434\u0430.');\n  }\n\n  /**\n   * \u0420\u0435\u0444\u0430\u043a\u0442\u043e\u0440\u0438\u043d\u0433 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0439\n   */\n  async suggestRefactoring(code: string, issue?: string): Promise<string> {\n    const prompt = `\u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0438 \u0440\u0435\u0444\u0430\u043a\u0442\u043e\u0440\u0438\u043d\u0433 \u0434\u043b\u044f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u043a\u043e\u0434\u0430:\n\n${issue ? `\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430: ${issue}\\n\\n` : ''}\u041a\u043e\u0434:\n\\`\\`\\`\n${code}\n\\`\\`\\`\n\n\u041f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u044c \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u0441 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435\u043c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439.`;\n\n    return this.generate(prompt, '\u0422\u044b \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0440\u0435\u0444\u0430\u043a\u0442\u043e\u0440\u0438\u043d\u0433\u0443 \u043a\u043e\u0434\u0430 \u0438 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044e \u0435\u0433\u043e \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430.');\n  }\n\n  /**\n   * \u041f\u043e\u0438\u0441\u043a \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u0431\u0430\u0433\u043e\u0432\n   */\n  async findBugs(code: string, context?: string): Promise<string> {\n    const prompt = `\u041d\u0430\u0439\u0434\u0438 \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0431\u0430\u0433\u0438, \u043e\u0448\u0438\u0431\u043a\u0438 \u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0432 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u043a\u043e\u0434\u0435:\n\n${context ? `\u041a\u043e\u043d\u0442\u0435\u043a\u0441\u0442: ${context}\\n\\n` : ''}\u041a\u043e\u0434:\n\\`\\`\\`\n${code}\n\\`\\`\\`\n\n\u0423\u043a\u0430\u0436\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0441 \u043d\u043e\u043c\u0435\u0440\u0430\u043c\u0438 \u0441\u0442\u0440\u043e\u043a \u0438 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\u043c\u0438.`;\n\n    return this.generate(prompt, '\u0422\u044b \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043f\u043e\u0438\u0441\u043a\u0443 \u0431\u0430\u0433\u043e\u0432 \u0438 \u043f\u043e\u0442\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0445 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u0432 \u043a\u043e\u0434\u0435.');\n  }\n}\n\n\n/**\n * \u0423\u0442\u0438\u043b\u0438\u0442\u0430 \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f URL \u0441 \u0442\u043e\u043a\u0435\u043d\u043e\u043c \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438\n * \u0423\u043d\u0438\u0444\u0438\u0446\u0438\u0440\u0443\u0435\u0442 \u0441\u043f\u043e\u0441\u043e\u0431 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u0442\u043e\u043a\u0435\u043d\u0430 \u0434\u043b\u044f \u043c\u0435\u0434\u0438\u0430 \u0444\u0430\u0439\u043b\u043e\u0432\n */\n\nimport api from '../api';\n\n/**\n * \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442 URL \u0434\u043b\u044f \u043c\u0435\u0434\u0438\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441 \u0442\u043e\u043a\u0435\u043d\u043e\u043c \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438\n * \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f preview, download, thumbnail \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432\n * \n * @param endpoint - API endpoint (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, '/files/preview/123')\n * @param token - JWT \u0442\u043e\u043a\u0435\u043d (\u0435\u0441\u043b\u0438 \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u043d, \u0431\u0435\u0440\u0435\u0442\u0441\u044f \u0438\u0437 localStorage)\n * @returns \u041f\u043e\u043b\u043d\u044b\u0439 URL \u0441 \u0442\u043e\u043a\u0435\u043d\u043e\u043c \u0432 query \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0435\n */\nexport function getMediaUrl(endpoint: string, token?: string): string {\n  const authToken = token || localStorage.getItem('token');\n  if (!authToken) {\n    throw new Error('\u0422\u043e\u043a\u0435\u043d \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d');\n  }\n\n  // \u0423\u0431\u0438\u0440\u0430\u0435\u043c \u0432\u0435\u0434\u0443\u0449\u0438\u0439 \u0441\u043b\u0435\u0448 \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c\n  const cleanEndpoint = endpoint.startsWith('/') ? endpoint.slice(1) : endpoint;\n  \n  // \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u044b\u0439 URL \u0434\u043b\u044f \u043d\u0430\u0434\u0435\u0436\u043d\u043e\u0441\u0442\u0438 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430\u0445\n  let baseURL = api.defaults.baseURL || '/api';\n  // \u0423\u0431\u0438\u0440\u0430\u0435\u043c trailing slash \u0438\u0437 baseURL \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c\n  baseURL = baseURL.replace(/\\/$/, '');\n  // \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0432\u0435\u0434\u0443\u0449\u0438\u0439 \u0441\u043b\u0435\u0448 \u0435\u0441\u043b\u0438 \u0435\u0433\u043e \u043d\u0435\u0442\n  if (!baseURL.startsWith('/')) {\n    baseURL = '/' + baseURL;\n  }\n  \n  // \u0412\u0441\u0435\u0433\u0434\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u044b\u0439 URL \u0434\u043b\u044f \u043c\u0435\u0434\u0438\u0430 \u0444\u0430\u0439\u043b\u043e\u0432\n  const origin = window.location.origin;\n  const fullBaseURL = origin + baseURL;\n  \n  // \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0442\u043e\u043a\u0435\u043d \u0432 query \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\n  const separator = cleanEndpoint.includes('?') ? '&' : '?';\n  const url = `${fullBaseURL}/${cleanEndpoint}${separator}token=${encodeURIComponent(authToken)}`;\n  \n  // \u041b\u043e\u0433\u0438\u0440\u0443\u0435\u043c \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u043b\u044f \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u0441 \u0430\u0443\u0434\u0438\u043e\n  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n  console.log('[getMediaUrl] Generated URL:', { \n    endpoint, \n    cleanEndpoint, \n    url,\n    hasToken: !!authToken,\n    tokenLength: authToken?.length,\n    baseURL,\n    fullBaseURL,\n    origin,\n    isMobile,\n    userAgent: navigator.userAgent\n  });\n  \n  return url;\n}\n\n/**\n * \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442 URL \u0434\u043b\u044f \u043c\u0435\u0434\u0438\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441 \u0442\u043e\u043a\u0435\u043d\u043e\u043c (\u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f)\n * \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 null \u0435\u0441\u043b\u0438 \u0442\u043e\u043a\u0435\u043d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\n * \n * @param endpoint - API endpoint", "timestamp": 1766781010.3112152, "ttl": 3600}